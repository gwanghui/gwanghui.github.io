<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="monitoring-prometheus"><meta name="keywords" content="monitoring,prometheus"><meta name="author" content="GwangHui Park"><meta name="copyright" content="GwangHui Park"><title>monitoring-prometheus | Gwang Story</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#prometheus"><span class="toc-number">1.</span> <span class="toc-text"> Prometheus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#모니터링이란"><span class="toc-number">2.</span> <span class="toc-text"> 모니터링이란</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#모니터링의-범주"><span class="toc-number">3.</span> <span class="toc-text"> 모니터링의 범주</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#프로파일링"><span class="toc-number">4.</span> <span class="toc-text"> 프로파일링</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#트레이싱"><span class="toc-number">5.</span> <span class="toc-text"> 트레이싱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#로깅"><span class="toc-number">6.</span> <span class="toc-text"> 로깅</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#로깅의-범주"><span class="toc-number">6.1.</span> <span class="toc-text"> 로깅의 범주</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#메트릭"><span class="toc-number">7.</span> <span class="toc-text"> 메트릭</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">GwangHui Park</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">103</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">47</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">12</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Gwang Story</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">monitoring-prometheus</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-20</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h3 id="prometheus"><a class="markdownIt-Anchor" href="#prometheus"></a> Prometheus</h3>
<ul>
<li>Metric 기반 오픈소스 모니터링 시스템
<ul>
<li>데이터 모델 : Label (key-value time series)</li>
<li>쿼리 언어</li>
<li>CNCF 재단 멤버</li>
<li>Integration Library를 통해 third-party App들 연계 가능</li>
<li>알람 기능</li>
</ul>
</li>
</ul>
<h3 id="모니터링이란"><a class="markdownIt-Anchor" href="#모니터링이란"></a> 모니터링이란</h3>
<ul>
<li>Alerting(알림) : 문제가 발생한 시기나 시점을 파악하는 것이 모니터링에서는 가장 중요하다.</li>
<li>Debugging(디버깅) : 문제의 근본 원인을 규명하고 문제가 무엇이든 간에 반드시 해결해야 한다.</li>
<li>Trending(추세 파악) : 시스템이 어떻게 사용되고 시간에 따라 변화하는지를 확인할 수 있는 기능. Capacity Planning 과 같은 설계 결정과 프로세스에 영향을 미칠 수 있다.</li>
<li>Plumbing(플러밍) : 망치를 가지고 있으면, 모든 것이 못처럼 보이기 시작한다. 데이터 처리 파이프라인으로</li>
</ul>
<h3 id="모니터링의-범주"><a class="markdownIt-Anchor" href="#모니터링의-범주"></a> 모니터링의 범주</h3>
<ul>
<li>HTTP 요청 수신</li>
<li>HTTP 400 응답 송신</li>
<li>entering a function (함수 시작)</li>
<li>leaving a function (함수 종료)</li>
<li>if 문의 else에 도달</li>
<li>사용자 로그인</li>
<li>디스크에 데이터 쓰기</li>
<li>네트워크에서 데이터 읽기</li>
<li>커널에 추가 메모리 요청</li>
<li>모든 이벤트에는 컨텍스트가 있다.
<ul>
<li>HTTP 요청에는 들어오고 나가는 IP주소, 요청 URL 설정된 쿠키, 요청한 사용자 정보가 포함되어있다.</li>
<li>HTTP 응답에는 응답에 걸린 시간, HTTP 상태 코드, 응답 본문의 길이가 있다.</li>
<li>함수를 포함하는 이벤트에는 함수 상단에 있는 함수들의 콜 스택과 HTTP 요청처럼 무엇이 해당 스택의 일부를 트리거 했는지에 대한 정보가 담겨있다.</li>
</ul>
</li>
</ul>
<h3 id="프로파일링"><a class="markdownIt-Anchor" href="#프로파일링"></a> 프로파일링</h3>
<ul>
<li>profiling (프로파일링)은 우리가 모든 시간에 대해 모든 이벤트의 컨텍스트를 가질 수 없지만, 제한된 기간의 일부 컨텍스트를 가질 수 있다는 방식으로 접근한다.</li>
<li>Tcpdump는 프로파일링 도구의 하나로, 지정된 필터를 기반으로 네트워크 트래픽을 기록할 수 있다. Tcpdump는 필수적인 디버깅 도구지만, 실제로는 디스크 공간이 부족해 질수 있다.</li>
<li>리눅스 커널의 eBPF(enhanced Berkeley Packet Filters)는 파일시스템부터 네트워크 기호까지 커널 이벤트에 대해 상세하게 프로파일링을 할 수 있다.</li>
<li>오랜 시간 동안 프로프알링을 해야하는 경우, 다른 모니터링 방법과 함께 사용하려면 <em>반드시</em> 데이터의 양을 줄여야 한다.</li>
</ul>
<h3 id="트레이싱"><a class="markdownIt-Anchor" href="#트레이싱"></a> 트레이싱</h3>
<ul>
<li>tracing(트레이싱)은 모든 이벤트를 살펴보는 것이 아니라, 관심 기능을 통과하는 일부 이벤트 처럼 수백 개의 이벤트 중 특정 이벤트에만 집중한다.</li>
<li>Stack Trace에서 관심 있는 부분의 함수들을 기록하고, 때때로 이러한 함수들이 얼마나 오랫동안 수행되었는지도 기록한다.</li>
<li>트레이싱 시스템 중 일부는 관심 지정에서 스택 트레이스에 스냅샷을 수집하는 대신 관심 있는 함수 하위의 모든 함수 호출을 추적하고 타이밍을 기록한다.</li>
<li>HTTP 요청 중 하나를 샘플링할 수 있고, 이 요청에 대해 데이터베이스나 캐시같은 백엔드와 통신하는 데 얼마나 오랜 시간이 소비되었는지 확인할 수 있다.</li>
<li>Distributed tracing(분산 트레이싱)은 한단계 더 나아가 원격 프로시저 호출에서 다른 프로세스로 전달되는 요청에 고유 ID 를 추가해 해당 요청이 추적되어야 하는지 여부등 프로세스 전반에 걸친 작업을 추적한다.</li>
<li>트레이싱에서 데이터 볼륭 유지 및 계측 성능에 영향을 미치는 것은 sampling(샘플링)이다.</li>
</ul>
<h3 id="로깅"><a class="markdownIt-Anchor" href="#로깅"></a> 로깅</h3>
<ul>
<li>logging은 제한된 이벤트 집합을 살펴보고 각 이벤트에 대한 컨텍스트 일부를 기록한다.</li>
<li>로깅의 장점은 이벤트에 대한 샘플링이 없다는 점이다. 따라서 필드 개수를 제한하더라도, 시간이 오래 걸리는 요청이 특정 API 엔드포인트와 통신하는 특정 유저에게 얼마나 영향을 미치는지를 판단해야 한다.</li>
</ul>
<h4 id="로깅의-범주"><a class="markdownIt-Anchor" href="#로깅의-범주"></a> 로깅의 범주</h4>
<ul>
<li>Transaction Logs(트랜잭션 로그) : 어떠한 대가를 치르더라도 영원히 안전하게 보관해야 하는 중요한 비지니스 기록이다.<br />
주로 비용과 연관된 기능이나 사용자가 직접 사용하는 주요 기능이 트랜잭션 로그에 속한다.</li>
<li>Request logs(요청 로그) : 모든 HTTP 요청이나 데이터베이스 호출을 track(추적)하는 경우의 로그다.<br />
요청 로그는 사용자가 직접 사용하는 기능이나 내부 최적화의 구현에 쓰인다. 대부분은 요청 로그가 삭제되는 것을 바라지 않겠지만, 그렇다고 로그 중 일부를 잃는다고 해서 큰 문제가 되진 않는다.</li>
<li>Application Logs(애플리케이션 로그) : 모든 로그가 요청 로그인 것은 아니며, 프로세스 그 자체에 관한 로그도 있다. 시작 메시지, 백그라운드 유지보수 작업, 프로세스 수준의 로그<br />
주로 사람들이 직접 읽기 때문에 정상적인 동작에서 1분당 몇 개 정도가 적절하다.</li>
<li>Debug Logs(디버그 로그) : 디버그 로그는 굉장히 상세해서 생성과 저장에 비용이 많이 든다. 협소한 디버깅 상황에서만 사용되며, 데이터의 양 때문에 프로파일링의 특성을 띈다.</li>
</ul>
<h3 id="메트릭"><a class="markdownIt-Anchor" href="#메트릭"></a> 메트릭</h3>
<ul>
<li>metric(메트릭)은 컨텍스트를 대부분 무시하고 다양한 유형의 이벤트에 대해 시간에 따른 aggregation(집계)을 추적한다. 자원 사용을 정상적으로 유지하려면, 추적하는 메트릭의 개수를 제한해야한다.</li>
<li>프로세스당 1만개의 메트릭 처리정도가 합리적인 상한선 일 것이다.</li>
<li>metric을 이용하면 애플리케이션의 각 서브시스템에서의 대기 시간과 처리하는 데이터양을 추적해서 성능 저하의 원인이 정확히 무엇인지 손쉽게 알아낼 수 있다.</li>
<li>어떤 서브시스템에 문제의 원인이 있는지 찾아낸 다음, 로그를 통해 해당 문제에 관련된 사용자 요청을 정확하게 파악할 수 있다.</li>
<li>메트릭은 프로세스 전반에 걸쳐 이벤트 정보를 수집할 수 있지만, 일반적으로 카디널리티가 제한된 컨텍스트는 1~2개 이상의 필드를 갖지 않는다.</li>
<li>로그는 한 가지 유형 이벤트에 대해 모든 정보를 수집할 수 있지만, 카디널리티가 제한되지 않은 컨텍스트에 대해 수백 개 필드만 추적할 수 있다.</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">GwangHui Park</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.devkwang.app/2021/05/20/monitoring-prometheus/">https://blog.devkwang.app/2021/05/20/monitoring-prometheus/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/monitoring/">monitoring</a><a class="post-meta__tags" href="/tags/prometheus/">prometheus</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/05/25/distributed-architecture-article-01/"><i class="fa fa-chevron-left">  </i><span>distributed-architecture-article-01</span></a></div><div class="next-post pull-right"><a href="/2021/04/13/exchange-ready-april/"><span>exchange-ready-april</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By GwangHui Park</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>