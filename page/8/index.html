<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="GwangHui Park"><meta name="copyright" content="GwangHui Park"><title>History | Gwang Story</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">GwangHui Park</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">100</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">47</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">12</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Gwang Story</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Gwang Story</div><div id="site-sub-title">History</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/31/security-webapplicationhacker-1/">security-webapplicationhacker-1</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-31</time><div class="content"><h2 id="핵심-방어-매커니즘"><a class="markdownIt-Anchor" href="#핵심-방어-매커니즘"></a> 핵심 방어 매커니즘</h2>
<ul>
<li>권한이 없는 사용자가 민감한 정보에 접근하는 것을 막기 위해 어플리케이션의 데이터와 기능에 대한 사용자 접근 처리</li>
<li>의도하지 않은 행동을 유발시키는 사용자 입력을 막기 위해 어플리케이션의 기능에 대한 사용자 입력 값 처리</li>
<li>어플리케이션이 공격자로부터 직접적인 공격 대상이 됐을 때 이를 방어하고 보안 수준을 높이기 위한 공격자에 대한 처리</li>
<li>어플리케이션에 대해 실시간으로 모니터링 할 수 있는 기능을 관리자에게 제공함으로써 관리자가 안전하게 어플리케이션을 관리할 수 있게 함</li>
</ul>
<h2 id="사용자-접근-처리"><a class="markdownIt-Anchor" href="#사용자-접근-처리"></a> 사용자 접근 처리</h2>
<ul>
<li>사용자 범주
<ul>
<li>익명 사용자(anonymous users), 인가된 사용자(ordinary authenticated users), 관리적 사용자 (administrative users)</li>
</ul>
</li>
</ul>
<h3 id="인증"><a class="markdownIt-Anchor" href="#인증"></a> 인증</h3>
<ul>
<li>ID/PWD, 클라이언트 인증, 스마트카드, Access Token
<ul>
<li>공격자가 다른 사용자의 아이디와 비밀번호를 추측하거나 로직에 있는 결함을 악용함으로써 인증 과정을 우회할 가능성이 있다.</li>
</ul>
</li>
</ul>
<h3 id="세션-관리"><a class="markdownIt-Anchor" href="#세션-관리"></a> 세션 관리</h3>
<ul>
<li>모든 어플리케이션은 각 사용자를 위한 세션을 만들어 주거나 사용자에게 세션을 확인하게 하는 토큰을 발행한다.</li>
<li>세션 자체는 서버에 할당돼 있는 데이터 집합의 구조이며, 어플리케이션과 사용자간의 상호 작용을 도와주는 데 사용된다.</li>
<li>토큰이란 어플리케이션이 세션에 나타내는 독특한 문자열을 말한다. 표준방법은 HTTP 쿠키를 사용한다.</li>
<li>일부 어플리케이션은 세션 토큰을 사용하지 않고 사용자를 재확인하는 다른 수단으로 클라이언트에 상태 정보를 저장해 두는데 누군가 엿들을 수 있는 위험을 막기 위해 암호화 된다.</li>
</ul>
<h3 id="접근-통제"><a class="markdownIt-Anchor" href="#접근-통제"></a> 접근 통제</h3>
<ul>
<li>사용자 접근 통제의 마지막 단계는 애 플리케이션 에서 사용자의 요청이 허가되는지 아닌지 결정을 내리고 실행하는 것이다.</li>
</ul>
<h2 id="사용자-입력-값-처리"><a class="markdownIt-Anchor" href="#사용자-입력-값-처리"></a> 사용자 입력 값 처리</h2>
<h3 id="입력-값-조작에-대한-처리-방법"><a class="markdownIt-Anchor" href="#입력-값-조작에-대한-처리-방법"></a> 입력 값 조작에 대한 처리 방법</h3>
<ul>
<li>위험하다고 알려진 것들은 모두 차단</li>
<li>안전하다고 알려진 용것들은 모두 수</li>
<li>불순물 제거 (Sanitization)</li>
<li>안전한 데이터 처리</li>
<li>의미론적 검증법</li>
</ul>
<h3 id="경계-검증"><a class="markdownIt-Anchor" href="#경계-검증"></a> 경계 검증</h3>
<ul>
<li>프로세스의 여러 딘계에서 경계 검증을 하는 애플리케이션 기능</li>
</ul>
<p><img src="/images/webhack/mechanism/2-5.png" alt="" /></p>
<h3 id="다단계-검증과-정규화"><a class="markdownIt-Anchor" href="#다단계-검증과-정규화"></a> 다단계 검증과 정규화</h3>
<ul>
<li>Ex) Cross-Site-script 우회</li>
</ul>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">filter 우회</span><br><span class="line">&lt;scr&lt;script&gt;ipt&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>어플리케이션이 처음으로 …/를 제거한 후 인용부호를 떼어버린다면 다음의 입력 값은 검증을 실패로 만드는 데 사용될 수 있다.</p>
<ul>
<li>…/</li>
</ul>
</li>
<li>
<p>URL Encoding filter 우회</p>
<ul>
<li>%2527 -&gt; %27</li>
<li>%%2727</li>
</ul>
</li>
<li>
<p>HTML 인코딩 filter 우회</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">j&amp;#x61;vasc&amp;#x72ipt&amp;#x3a;alert&amp;#x28;1&amp;#x29;</span> &gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>좋은 처리 방법은 입력 값의 한 부분이라도 수정이 인ㄹ어나지 않을 때까지 계속 재귀적으로 불안전한 문자를 안전한 상태로 만드는 불순물 제거(Sanitization) 작업을 수행하는 것이다.</li>
</ul>
<h3 id="공격자-핸들링"><a class="markdownIt-Anchor" href="#공격자-핸들링"></a> 공격자 핸들링</h3>
<ul>
<li>
<p>에러 핸들링 (Handling Errors) : 어플리케이션은 시스템 기반 메세지나 디버깅 정보를 노출시켜서는 안 된다.<br />
<img src="/images/webhack/mechanism/2-6.png" alt="" /></p>
</li>
<li>
<p>감시 로그 관리 (Maintaining Audit Log) : 어플리케이션은 시스템 기반 메세지나 디버깅 정보를 노출시켜서는 안 된다.</p>
<ul>
<li>로그인 성공, 로그인 실패, 비밀번호 변경과 같은 인증 기능과 관련된 모든 이벤트</li>
<li>신용카드 결제와 자금 이체 같은 주요 거래</li>
<li>접근 통제 메커니즘에 의해 막혀진 접근 시도</li>
<li>잘 알려진 공격 문자열을 포함하고 있는 악의적인 의도를 명확하게 표시하는 요청<br />
<img src="/images/webhack/mechanism/2-7.png" alt="" /></li>
</ul>
</li>
<li>
<p>관리자에게 경고 (Alerting Administrators)</p>
<ul>
<li>하나의 IP 주소나 한 명의 사용자로부터 비정상적으로 많은 양의 요청을 받은 경우</li>
<li>하나의 은행 계좌로부터 평소와 다르게 많은 돈이 인출된 경우</li>
<li>잘 알려진 공격 문자열을 포함하는 경우</li>
<li>일반 사용자들에게 숨겨진 데이터가 수정된 경</li>
</ul>
</li>
<li>
<p>공격 대응 (Reacting to attacks)우</p>
<ul>
<li>공격자의 요청에 점차적으로 늦게 대응하</li>
<li>공격자의 세션을 종료시킴</li>
</ul>
</li>
</ul>
<h2 id="어플리케이션-관리"><a class="markdownIt-Anchor" href="#어플리케이션-관리"></a> 어플리케이션 관리</h2>
<ul>
<li>인증 메커니즘에서 약점은 공격자가 전체 어플리케이션을 위험에 빠지게 할 수 있는 관리적인 접근 획득이 가능할 수 있다는 점이다.</li>
<li>다수의 어플리케이션이 관리자 기능에 효과적인 접근 통제를 수행하지 안흔ㄴ다. 공격자는 높은 권한을 가진 새로운 사용자 계정을 생성하는 방법을 찾아 낼지도 모른다.</li>
<li>관리자 기능은 가끔 사용자로부터 발생되는 데이터를 표현하는 사항에 대한 기능을 포함하기도 한다. 관리 인터페이스 내에 있는 크로스사이트 스크립팅 취약점은 높은 권한을 가진 세션을 위협할 수도 있다.</li>
<li>관리자 기능은 신뢰되는 사용자에 의해 사용된다고 생각하기 때문에 덜 엄격한 보안 검사를 받게 된다.</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/30/java-class-clazz/">java-class-clazz</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-30</time><div class="content"><p>간단하게 instanceof는 특정 Object가 어떤 클래스/인터페이스를 상속/구현했는지를 체크하며<br />
Class.isAssignableFrom()은 특정 Class가 어떤 클래스/인터페이스를 상속/구현했는지 체크합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// instanceof</span></span><br><span class="line">MacPro obj = <span class="keyword">new</span> MacPro();</span><br><span class="line"><span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Computer) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Class.isAssignableFrom()</span></span><br><span class="line"><span class="keyword">if</span> (Computer.class.isAssignableFrom(MacPro.class)) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>특정 클래스가 다른 인터페이스를 구현했거나 상속받았는지를 체크하기 위해서는 어떻게 하면 될까? 상위클래스들을 모조리(java.lang.Object 가 될때까지) 찾아다니면서 구현한 Interface들을 확인하면 될것도 같은데 왠지 세련되지 않은 것 같다.<br />
isAssignableFrom 이라는 메소드는 위 문제를 쉽게 해결해준다.<br />
내가 원하는 것은 사용자로부터 입력받은 클래스가 java.util.Collection 인터페이스를 (implements)구현한 클래스인지 체크하는 것이었다.</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/30/Spring-annotation/">Spring-annotation</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-30</time><div class="content"><p>@ConfigurationProperties</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/30/spring-security-oauth2/">spring-security-oauth2</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-30</time><div class="content"><h2 id="spring-security-oauth2-vs-spring-security"><a class="markdownIt-Anchor" href="#spring-security-oauth2-vs-spring-security"></a> Spring-Security-oauth2 vs Spring Security</h2>
<ul>
<li>Group ID Spring Security 안의 ArtifactID로 oauth2로 이관되면서 Group ID가 security-oauth2 였던 OSS가 Deprecated 되었다.</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  thymeleaf:</span></span><br><span class="line"><span class="attr">    cache:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  security:</span></span><br><span class="line"><span class="attr">    oauth2:</span></span><br><span class="line"><span class="attr">      client:</span></span><br><span class="line"><span class="attr">        registration:</span></span><br><span class="line"><span class="attr">          messaging-client-auth-code:</span></span><br><span class="line"><span class="attr">            provider:</span> <span class="string">keycloak</span></span><br><span class="line"><span class="attr">            client-id:</span> <span class="string">messaging-client</span></span><br><span class="line"><span class="attr">            client-secret:</span> <span class="string">secret</span></span><br><span class="line"><span class="attr">            authorization-grant-type:</span> <span class="string">authorization_code</span></span><br><span class="line"><span class="attr">            redirect-uri:</span> <span class="string">"&#123;baseUrl&#125;/authorized"</span></span><br><span class="line"><span class="attr">            scope:</span> <span class="string">message.read,message.write</span></span><br><span class="line"><span class="attr">          messaging-client-client-creds:</span></span><br><span class="line"><span class="attr">            provider:</span> <span class="string">keycloak</span></span><br><span class="line"><span class="attr">            client-id:</span> <span class="string">messaging-client</span></span><br><span class="line"><span class="attr">            client-secret:</span> <span class="string">secret</span></span><br><span class="line"><span class="attr">            authorization-grant-type:</span> <span class="string">client_credentials</span></span><br><span class="line"><span class="attr">            scope:</span> <span class="string">message.read,message.write</span></span><br><span class="line"><span class="attr">          messaging-client-password:</span></span><br><span class="line"><span class="attr">            provider:</span> <span class="string">keycloak</span></span><br><span class="line"><span class="attr">            client-id:</span> <span class="string">messaging-client</span></span><br><span class="line"><span class="attr">            client-secret:</span> <span class="string">secret</span></span><br><span class="line"><span class="attr">            authorization-grant-type:</span> <span class="string">password</span></span><br><span class="line"><span class="attr">            scope:</span> <span class="string">message.read,message.write</span></span><br><span class="line"><span class="attr">        provider:</span></span><br><span class="line"><span class="attr">          keycloak:</span></span><br><span class="line"><span class="attr">            authorization-uri:</span> <span class="attr">http://localhost:8090/auth/realms/oauth2-sample/protocol/openid-connect/auth</span></span><br><span class="line"><span class="attr">            token-uri:</span> <span class="attr">http://localhost:8090/auth/realms/oauth2-sample/protocol/openid-connect/token</span></span><br></pre></td></tr></table></figure>
<h3 id="clientregistration"><a class="markdownIt-Anchor" href="#clientregistration"></a> ClientRegistration</h3>
<ul>
<li>Oauth 2.0 or OpenID Connect 1.0 Provider 들에 등록된 Client의 정보들을 적게된다.</li>
<li>client 정보에는 ID, Secret, authorization grant type, redirect URL… etc</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientRegistration</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = SpringSecurityCoreVersion.SERIAL_VERSION_UID;</span><br><span class="line">	<span class="keyword">private</span> String registrationId;</span><br><span class="line">	<span class="keyword">private</span> String clientId;</span><br><span class="line">	<span class="keyword">private</span> String clientSecret;</span><br><span class="line">	<span class="keyword">private</span> ClientAuthenticationMethod clientAuthenticationMethod = ClientAuthenticationMethod.BASIC;</span><br><span class="line">	<span class="keyword">private</span> AuthorizationGrantType authorizationGrantType;</span><br><span class="line">	<span class="keyword">private</span> String redirectUriTemplate;</span><br><span class="line">	<span class="keyword">private</span> Set&lt;String&gt; scopes = Collections.emptySet();</span><br><span class="line">	<span class="keyword">private</span> ProviderDetails providerDetails = <span class="keyword">new</span> ProviderDetails();</span><br><span class="line">	<span class="keyword">private</span> String clientName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderDetails</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = SpringSecurityCoreVersion.SERIAL_VERSION_UID;</span><br><span class="line">        <span class="keyword">private</span> String authorizationUri;</span><br><span class="line">        <span class="keyword">private</span> String tokenUri;</span><br><span class="line">        <span class="keyword">private</span> UserInfoEndpoint userInfoEndpoint = <span class="keyword">new</span> UserInfoEndpoint();</span><br><span class="line">        <span class="keyword">private</span> String jwkSetUri;</span><br><span class="line">        <span class="keyword">private</span> Map&lt;String, Object&gt; configurationMetadata = Collections.emptyMap();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>registrationId: The ID that uniquely identifies the ClientRegistration.</li>
<li>clientId: The client identifier.</li>
<li>clientSecret: The client secret.</li>
<li>clientAuthenticationMethod: The method used to authenticate the Client with the Provider. The supported values are basic, post and none (public clients).</li>
<li>authorizationGrantType: The OAuth 2.0 Authorization Framework defines four Authorization Grant types. The supported values are authorization_code, client_credentials and password.</li>
<li>redirectUriTemplate: The client’s registered redirect URI that the Authorization Server redirects the end-user’s user-agent to after the end-user has authenticated and authorized access to the client.</li>
<li>scopes: The scope(s) requested by the client during the Authorization Request flow, such as openid, email, or profile.</li>
<li>clientName: A descriptive name used for the client. The name may be used in certain scenarios, such as when displaying the name of the client in the auto-generated login page.</li>
<li>authorizationUri: The Authorization Endpoint URI for the Authorization Server.</li>
<li>tokenUri: The Token Endpoint URI for the Authorization Server.</li>
<li>jwkSetUri: The URI used to retrieve the JSON Web Key (JWK) Set from the Authorization Server, which contains the cryptographic key(s) used to verify the JSON Web Signature (JWS) of the ID Token and optionally the UserInfo Response.</li>
<li>configurationMetadata: The OpenID Provider Configuration Information. This information will only be available if the Spring Boot 2.x property spring.security.oauth2.client.provider.[providerId].issuerUri is configured.</li>
<li>(userInfoEndpoint)uri: The UserInfo Endpoint URI used to access the claims/attributes of the authenticated end-user.</li>
<li>(userInfoEndpoint)authenticationMethod: The authentication method used when sending the access token to the UserInfo Endpoint. The supported values are header, form and query.</li>
<li>userNameAttributeName: The name of the attribute returned in the UserInfo Response that references the Name or Identifier of the end-user.</li>
</ol>
<blockquote>
<p>Endpoint 별 초기화</p>
<blockquote>
<p>OpenID Connect Provider : configuration endpoint<br />
OAuth2.0 : Metadata endpoint</p>
</blockquote>
</blockquote>
<h3 id="clientregistrationrepository"><a class="markdownIt-Anchor" href="#clientregistrationrepository"></a> ClientRegistrationRepository</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">InMemoryClientRegistrationRepository</span> <span class="keyword">implements</span> <span class="title">ClientRegistrationRepository</span>, <span class="title">Iterable</span>&lt;<span class="title">ClientRegistration</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ClientRegistration&gt; registrations;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ClientRegistration <span class="title">findByRegistrationId</span><span class="params">(String registrationId)</span> </span>&#123;</span><br><span class="line">		Assert.hasText(registrationId, <span class="string">"registrationId cannot be empty"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.registrations.get(registrationId);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Default 구현체는 InMemoryClientRegistrationRepository 이다.</li>
<li>Map으로 ClientRegistration 들을 가지고 있으며, 해당 registrationId 로 ClientRegistration을 찾을수 있는 기능을 제공한다.</li>
<li>Spring boot 2.x auto-configuration은 spring.security.oauth2.client.registration.[registrationId] 의 형태로 바인드를 자동으로 해놓는다.</li>
<li>또한 ClientRegistrationRepository라는 이름으로 Bean 등록을 해놓았기 때문에 Inject 받아서 사용가능하다.</li>
</ul>
<h3 id="oauthauthorizedclient"><a class="markdownIt-Anchor" href="#oauthauthorizedclient"></a> OAuthAuthorizedClient</h3>
<ul>
<li>Authorized Client를 표현한다.</li>
<li>Authorized Client는 보호되는 자원에 대한 Access 권한을 받은 것으로 간주된다.</li>
<li>Oauth2AuthorizedClient 는 ClientRegistration과 Resource Owner(End-user) 간 OAuth2AccessToken, OAuth2RefreshToken을 연결시켜준다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OAuth2AuthorizedClient</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = SpringSecurityCoreVersion.SERIAL_VERSION_UID;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> ClientRegistration clientRegistration;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String principalName;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> OAuth2AccessToken accessToken;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> OAuth2RefreshToken refreshToken;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="oauth2authorizedclientrepository"><a class="markdownIt-Anchor" href="#oauth2authorizedclientrepository"></a> OAuth2AuthorizedClientRepository</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthenticatedPrincipalOAuth2AuthorizedClientRepository</span> <span class="keyword">implements</span> <span class="title">OAuth2AuthorizedClientRepository</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> AuthenticationTrustResolver authenticationTrustResolver = <span class="keyword">new</span> AuthenticationTrustResolverImpl();</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> OAuth2AuthorizedClientService authorizedClientService;</span><br><span class="line">	<span class="keyword">private</span> OAuth2AuthorizedClientRepository anonymousAuthorizedClientRepository = <span class="keyword">new</span> HttpSessionOAuth2AuthorizedClientRepository();</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> &lt;T extends OAuth2AuthorizedClient&gt; <span class="function">T <span class="title">loadAuthorizedClient</span><span class="params">(String clientRegistrationId, Authentication principal,</span></span></span><br><span class="line"><span class="function"><span class="params">																		HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.isPrincipalAuthenticated(principal)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>.authorizedClientService.loadAuthorizedClient(clientRegistrationId, principal.getName());</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>.anonymousAuthorizedClientRepository.loadAuthorizedClient(clientRegistrationId, principal, request);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAuthorizedClient</span><span class="params">(OAuth2AuthorizedClient authorizedClient, Authentication principal,</span></span></span><br><span class="line"><span class="function"><span class="params">										HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.isPrincipalAuthenticated(principal)) &#123;</span><br><span class="line">			<span class="keyword">this</span>.authorizedClientService.saveAuthorizedClient(authorizedClient, principal);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">this</span>.anonymousAuthorizedClientRepository.saveAuthorizedClient(authorizedClient, principal, request, response);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeAuthorizedClient</span><span class="params">(String clientRegistrationId, Authentication principal,</span></span></span><br><span class="line"><span class="function"><span class="params">										HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.isPrincipalAuthenticated(principal)) &#123;</span><br><span class="line">			<span class="keyword">this</span>.authorizedClientService.removeAuthorizedClient(clientRegistrationId, principal.getName());</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">this</span>.anonymousAuthorizedClientRepository.removeAuthorizedClient(clientRegistrationId, principal, request, response);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isPrincipalAuthenticated</span><span class="params">(Authentication authentication)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> authentication != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">				!<span class="keyword">this</span>.authenticationTrustResolver.isAnonymous(authentication) &amp;&amp;</span><br><span class="line">				authentication.isAuthenticated();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>AuthenticationTrustResolver에 질의해 인증된 사용자라면 service에 요청하고 아니면 anonymousAuthorizedClientRepository에 요청한다.</li>
<li>OAuth2AuthorizationCodeAuthenticationToken으로 인증을 진행한다.</li>
<li>Session Attribute Name = org.springframework.security.oauth2.client.web.HttpSessionOAuth2AuthorizedClientRepository.AUTHORIZED_CLIENTS</li>
<li>내부에 anonymousAuthorizedClientRepository로 HttpSessionOAuth2AuthorizedClientRepository을 가지고 있다.</li>
<li>해당 Session Attribute Name으로 AuthorizedClient들을 저장하고 있다.</li>
</ul>
<h3 id="authenticationtrustresolver"><a class="markdownIt-Anchor" href="#authenticationtrustresolver"></a> AuthenticationTrustResolver</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthenticationTrustResolverImpl</span> <span class="keyword">implements</span> <span class="title">AuthenticationTrustResolver</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Class&lt;? extends Authentication&gt; anonymousClass = AnonymousAuthenticationToken.class;</span><br><span class="line">	<span class="keyword">private</span> Class&lt;? extends Authentication&gt; rememberMeClass = RememberMeAuthenticationToken.class;</span><br><span class="line"></span><br><span class="line">	Class&lt;? extends Authentication&gt; getAnonymousClass() &#123;</span><br><span class="line">		<span class="keyword">return</span> anonymousClass;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	Class&lt;? extends Authentication&gt; getRememberMeClass() &#123;</span><br><span class="line">		<span class="keyword">return</span> rememberMeClass;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAnonymous</span><span class="params">(Authentication authentication)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ((anonymousClass == <span class="keyword">null</span>) || (authentication == <span class="keyword">null</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> anonymousClass.isAssignableFrom(authentication.getClass());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isRememberMe</span><span class="params">(Authentication authentication)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ((rememberMeClass == <span class="keyword">null</span>) || (authentication == <span class="keyword">null</span>)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> rememberMeClass.isAssignableFrom(authentication.getClass());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAnonymousClass</span><span class="params">(Class&lt;? extends Authentication&gt; anonymousClass)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.anonymousClass = anonymousClass;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRememberMeClass</span><span class="params">(Class&lt;? extends Authentication&gt; rememberMeClass)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.rememberMeClass = rememberMeClass;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Anonymous, RememberMe 를 구현하고 할당이 가능한지에 따라 True, False를 반환한다.</li>
</ul>
<h3 id="oauth2authorizedclientservice"><a class="markdownIt-Anchor" href="#oauth2authorizedclientservice"></a> OAuth2AuthorizedClientService</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">InMemoryOAuth2AuthorizedClientService</span> <span class="keyword">implements</span> <span class="title">OAuth2AuthorizedClientService</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> Map&lt;OAuth2AuthorizedClientId, OAuth2AuthorizedClient&gt; authorizedClients;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> ClientRegistrationRepository clientRegistrationRepository;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">InMemoryOAuth2AuthorizedClientService</span><span class="params">(ClientRegistrationRepository clientRegistrationRepository)</span> </span>&#123;</span><br><span class="line">		Assert.notNull(clientRegistrationRepository, <span class="string">"clientRegistrationRepository cannot be null"</span>);</span><br><span class="line">		<span class="keyword">this</span>.clientRegistrationRepository = clientRegistrationRepository;</span><br><span class="line">		<span class="keyword">this</span>.authorizedClients = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">InMemoryOAuth2AuthorizedClientService</span><span class="params">(ClientRegistrationRepository clientRegistrationRepository,</span></span></span><br><span class="line"><span class="function"><span class="params">													Map&lt;OAuth2AuthorizedClientId, OAuth2AuthorizedClient&gt; authorizedClients)</span> </span>&#123;</span><br><span class="line">		Assert.notNull(clientRegistrationRepository, <span class="string">"clientRegistrationRepository cannot be null"</span>);</span><br><span class="line">		Assert.notEmpty(authorizedClients, <span class="string">"authorizedClients cannot be empty"</span>);</span><br><span class="line">		<span class="keyword">this</span>.clientRegistrationRepository = clientRegistrationRepository;</span><br><span class="line">		<span class="keyword">this</span>.authorizedClients = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(authorizedClients);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">	<span class="keyword">public</span> &lt;T extends OAuth2AuthorizedClient&gt; <span class="function">T <span class="title">loadAuthorizedClient</span><span class="params">(String clientRegistrationId, String principalName)</span> </span>&#123;</span><br><span class="line">		Assert.hasText(clientRegistrationId, <span class="string">"clientRegistrationId cannot be empty"</span>);</span><br><span class="line">		Assert.hasText(principalName, <span class="string">"principalName cannot be empty"</span>);</span><br><span class="line">		ClientRegistration registration = <span class="keyword">this</span>.clientRegistrationRepository.findByRegistrationId(clientRegistrationId);</span><br><span class="line">		<span class="keyword">if</span> (registration == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> (T) <span class="keyword">this</span>.authorizedClients.get(<span class="keyword">new</span> OAuth2AuthorizedClientId(clientRegistrationId, principalName));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAuthorizedClient</span><span class="params">(OAuth2AuthorizedClient authorizedClient, Authentication principal)</span> </span>&#123;</span><br><span class="line">		Assert.notNull(authorizedClient, <span class="string">"authorizedClient cannot be null"</span>);</span><br><span class="line">		Assert.notNull(principal, <span class="string">"principal cannot be null"</span>);</span><br><span class="line">		<span class="keyword">this</span>.authorizedClients.put(<span class="keyword">new</span> OAuth2AuthorizedClientId(authorizedClient.getClientRegistration().getRegistrationId(),</span><br><span class="line">				principal.getName()), authorizedClient);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeAuthorizedClient</span><span class="params">(String clientRegistrationId, String principalName)</span> </span>&#123;</span><br><span class="line">		Assert.hasText(clientRegistrationId, <span class="string">"clientRegistrationId cannot be empty"</span>);</span><br><span class="line">		Assert.hasText(principalName, <span class="string">"principalName cannot be empty"</span>);</span><br><span class="line">		ClientRegistration registration = <span class="keyword">this</span>.clientRegistrationRepository.findByRegistrationId(clientRegistrationId);</span><br><span class="line">		<span class="keyword">if</span> (registration != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.authorizedClients.remove(<span class="keyword">new</span> OAuth2AuthorizedClientId(clientRegistrationId, principalName));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ClientRegistrationRepository를 가지고 있고, 해당 Repository에 CRUD를 하는 기능들을 가지고 있다.</li>
<li>Bean으로 선언되어 있어 Application레벨에서 사용이 용이하게 되어있다.</li>
</ul>
<h3 id="oauth2authorizedclientmanager"><a class="markdownIt-Anchor" href="#oauth2authorizedclientmanager"></a> OAuth2AuthorizedClientManager</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultOAuth2AuthorizedClientManager</span> <span class="keyword">implements</span> <span class="title">OAuth2AuthorizedClientManager</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> ClientRegistrationRepository clientRegistrationRepository;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> OAuth2AuthorizedClientRepository authorizedClientRepository;</span><br><span class="line">	<span class="keyword">private</span> OAuth2AuthorizedClientProvider authorizedClientProvider = context -&gt; <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> Function&lt;OAuth2AuthorizeRequest, Map&lt;String, Object&gt;&gt; contextAttributesMapper = <span class="keyword">new</span> DefaultContextAttributesMapper();</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> OAuth2AuthorizedClient <span class="title">authorize</span><span class="params">(OAuth2AuthorizeRequest authorizeRequest)</span> </span>&#123;</span><br><span class="line">		Assert.notNull(authorizeRequest, <span class="string">"authorizeRequest cannot be null"</span>);</span><br><span class="line"></span><br><span class="line">		String clientRegistrationId = authorizeRequest.getClientRegistrationId();</span><br><span class="line">		OAuth2AuthorizedClient authorizedClient = authorizeRequest.getAuthorizedClient();</span><br><span class="line">		Authentication principal = authorizeRequest.getPrincipal();</span><br><span class="line"></span><br><span class="line">		HttpServletRequest servletRequest = getHttpServletRequestOrDefault(authorizeRequest.getAttributes());</span><br><span class="line">		Assert.notNull(servletRequest, <span class="string">"servletRequest cannot be null"</span>);</span><br><span class="line">		HttpServletResponse servletResponse = getHttpServletResponseOrDefault(authorizeRequest.getAttributes());</span><br><span class="line">		Assert.notNull(servletResponse, <span class="string">"servletResponse cannot be null"</span>);</span><br><span class="line"></span><br><span class="line">		OAuth2AuthorizationContext.Builder contextBuilder;</span><br><span class="line">		<span class="keyword">if</span> (authorizedClient != <span class="keyword">null</span>) &#123;</span><br><span class="line">			contextBuilder = OAuth2AuthorizationContext.withAuthorizedClient(authorizedClient);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			ClientRegistration clientRegistration = <span class="keyword">this</span>.clientRegistrationRepository.findByRegistrationId(clientRegistrationId);</span><br><span class="line">			Assert.notNull(clientRegistration, <span class="string">"Could not find ClientRegistration with id '"</span> + clientRegistrationId + <span class="string">"'"</span>);</span><br><span class="line">			authorizedClient = <span class="keyword">this</span>.authorizedClientRepository.loadAuthorizedClient(</span><br><span class="line">					clientRegistrationId, principal, servletRequest);</span><br><span class="line">			<span class="keyword">if</span> (authorizedClient != <span class="keyword">null</span>) &#123;</span><br><span class="line">				contextBuilder = OAuth2AuthorizationContext.withAuthorizedClient(authorizedClient);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				contextBuilder = OAuth2AuthorizationContext.withClientRegistration(clientRegistration);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		OAuth2AuthorizationContext authorizationContext = contextBuilder</span><br><span class="line">				.principal(principal)</span><br><span class="line">				.attributes(attributes -&gt; &#123;</span><br><span class="line">					Map&lt;String, Object&gt; contextAttributes = <span class="keyword">this</span>.contextAttributesMapper.apply(authorizeRequest);</span><br><span class="line">					<span class="keyword">if</span> (!CollectionUtils.isEmpty(contextAttributes)) &#123;</span><br><span class="line">						attributes.putAll(contextAttributes);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br><span class="line">				.build();</span><br><span class="line"></span><br><span class="line">		authorizedClient = <span class="keyword">this</span>.authorizedClientProvider.authorize(authorizationContext);</span><br><span class="line">		<span class="keyword">if</span> (authorizedClient != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">this</span>.authorizedClientRepository.saveAuthorizedClient(authorizedClient, principal, servletRequest, servletResponse);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// In the case of re-authorization, the returned `authorizedClient` may be null if re-authorization is not supported.</span></span><br><span class="line">			<span class="comment">// For these cases, return the provided `authorizationContext.authorizedClient`.</span></span><br><span class="line">			<span class="keyword">if</span> (authorizationContext.getAuthorizedClient() != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> authorizationContext.getAuthorizedClient();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> authorizedClient;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>내부에 ClientRegistrationRepository로는 InMemoryClientRegistrationRepository를 가지고 있다.</li>
<li>내부에 AuthorizedClientRepository로 AuthenticatedPrincipalOAuth2AuthorizedClientRepository를 가지고 있다.</li>
<li>내부에 AuthenticationProvider로 DelegatingOAuth2AuthorizedClientProvider를 가지고 있다.
<ul>
<li>DelegatingOAuth2AuthorizedClientProvider는 Config에서 선언한 GrantType에 해당하는 Provider들을 전부 가지고 있다.</li>
</ul>
</li>
<li>The DefaultOAuth2AuthorizedClientManager is designed to be used within the context of a HttpServletRequest.<br />
When operating outside of a HttpServletRequest context, use AuthorizedClientServiceOAuth2AuthorizedClientManager instead.</li>
</ul>
<h3 id="oauth2authorizedclientprovider"><a class="markdownIt-Anchor" href="#oauth2authorizedclientprovider"></a> OAuth2AuthorizedClientProvider</h3>
<ul>
<li>각 GrantType에 따른 인증 방식이 들어있다.</li>
<li>인증을 하는 조건이 맞지 않으면 Throw Exception을 던진다.</li>
</ul>
<h3 id="oauth2authorizationrequestredirectfilter"><a class="markdownIt-Anchor" href="#oauth2authorizationrequestredirectfilter"></a> OAuth2AuthorizationRequestRedirectFilter</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OAuth2AuthorizationRequestRedirectFilter</span> <span class="keyword">extends</span> <span class="title">OncePerRequestFilter</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_AUTHORIZATION_REQUEST_BASE_URI = <span class="string">"/oauth2/authorization"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> ThrowableAnalyzer throwableAnalyzer = <span class="keyword">new</span> DefaultThrowableAnalyzer();</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> RedirectStrategy authorizationRedirectStrategy = <span class="keyword">new</span> DefaultRedirectStrategy();</span><br><span class="line">	<span class="keyword">private</span> OAuth2AuthorizationRequestResolver authorizationRequestResolver;</span><br><span class="line">	<span class="keyword">private</span> AuthorizationRequestRepository&lt;OAuth2AuthorizationRequest&gt; authorizationRequestRepository =</span><br><span class="line">		<span class="keyword">new</span> HttpSessionOAuth2AuthorizationRequestRepository();</span><br><span class="line">	<span class="keyword">private</span> RequestCache requestCache = <span class="keyword">new</span> HttpSessionRequestCache();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">OAuth2AuthorizationRequestRedirectFilter</span><span class="params">(ClientRegistrationRepository clientRegistrationRepository)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>(clientRegistrationRepository, DEFAULT_AUTHORIZATION_REQUEST_BASE_URI);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">OAuth2AuthorizationRequestRedirectFilter</span><span class="params">(ClientRegistrationRepository clientRegistrationRepository, String authorizationRequestBaseUri)</span> </span>&#123;</span><br><span class="line">		Assert.notNull(clientRegistrationRepository, <span class="string">"clientRegistrationRepository cannot be null"</span>);</span><br><span class="line">		Assert.hasText(authorizationRequestBaseUri, <span class="string">"authorizationRequestBaseUri cannot be empty"</span>);</span><br><span class="line">		<span class="keyword">this</span>.authorizationRequestResolver = <span class="keyword">new</span> DefaultOAuth2AuthorizationRequestResolver(</span><br><span class="line">				clientRegistrationRepository, authorizationRequestBaseUri);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">OAuth2AuthorizationRequestRedirectFilter</span><span class="params">(OAuth2AuthorizationRequestResolver authorizationRequestResolver)</span> </span>&#123;</span><br><span class="line">		Assert.notNull(authorizationRequestResolver, <span class="string">"authorizationRequestResolver cannot be null"</span>);</span><br><span class="line">		<span class="keyword">this</span>.authorizationRequestResolver = authorizationRequestResolver;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setAuthorizationRequestRepository</span><span class="params">(AuthorizationRequestRepository&lt;OAuth2AuthorizationRequest&gt; authorizationRequestRepository)</span> </span>&#123;</span><br><span class="line">		Assert.notNull(authorizationRequestRepository, <span class="string">"authorizationRequestRepository cannot be null"</span>);</span><br><span class="line">		<span class="keyword">this</span>.authorizationRequestRepository = authorizationRequestRepository;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setRequestCache</span><span class="params">(RequestCache requestCache)</span> </span>&#123;</span><br><span class="line">		Assert.notNull(requestCache, <span class="string">"requestCache cannot be null"</span>);</span><br><span class="line">		<span class="keyword">this</span>.requestCache = requestCache;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			OAuth2AuthorizationRequest authorizationRequest = <span class="keyword">this</span>.authorizationRequestResolver.resolve(request);</span><br><span class="line">			<span class="keyword">if</span> (authorizationRequest != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">this</span>.sendRedirectForAuthorization(request, response, authorizationRequest);</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception failed) &#123;</span><br><span class="line">			<span class="keyword">this</span>.unsuccessfulRedirectForAuthorization(request, response, failed);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			filterChain.doFilter(request, response);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> ex;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">			<span class="comment">// Check to see if we need to handle ClientAuthorizationRequiredException</span></span><br><span class="line">			Throwable[] causeChain = <span class="keyword">this</span>.throwableAnalyzer.determineCauseChain(ex);</span><br><span class="line">			ClientAuthorizationRequiredException authzEx = (ClientAuthorizationRequiredException) <span class="keyword">this</span>.throwableAnalyzer</span><br><span class="line">				.getFirstThrowableOfType(ClientAuthorizationRequiredException.class, causeChain);</span><br><span class="line">			<span class="keyword">if</span> (authzEx != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					OAuth2AuthorizationRequest authorizationRequest = <span class="keyword">this</span>.authorizationRequestResolver.resolve(request, authzEx.getClientRegistrationId());</span><br><span class="line">					<span class="keyword">if</span> (authorizationRequest == <span class="keyword">null</span>) &#123;</span><br><span class="line">						<span class="keyword">throw</span> authzEx;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">this</span>.sendRedirectForAuthorization(request, response, authorizationRequest);</span><br><span class="line">					<span class="keyword">this</span>.requestCache.saveRequest(request, response);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception failed) &#123;</span><br><span class="line">					<span class="keyword">this</span>.unsuccessfulRedirectForAuthorization(request, response, failed);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (ex <span class="keyword">instanceof</span> ServletException) &#123;</span><br><span class="line">				<span class="keyword">throw</span> (ServletException) ex;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> RuntimeException) &#123;</span><br><span class="line">				<span class="keyword">throw</span> (RuntimeException) ex;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(ex);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendRedirectForAuthorization</span><span class="params">(HttpServletRequest request, HttpServletResponse response, OAuth2AuthorizationRequest authorizationRequest)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (AuthorizationGrantType.AUTHORIZATION_CODE.equals(authorizationRequest.getGrantType())) &#123;</span><br><span class="line">			<span class="keyword">this</span>.authorizationRequestRepository.saveAuthorizationRequest(authorizationRequest, request, response);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">this</span>.authorizationRedirectStrategy.sendRedirect(request, response, authorizationRequest.getAuthorizationRequestUri());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unsuccessfulRedirectForAuthorization</span><span class="params">(HttpServletRequest request, HttpServletResponse response,	Exception failed)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (logger.isErrorEnabled()) &#123;</span><br><span class="line">			logger.error(<span class="string">"Authorization Request failed: "</span> + failed.toString(), failed);</span><br><span class="line">		&#125;</span><br><span class="line">		response.sendError(HttpStatus.INTERNAL_SERVER_ERROR.value(), HttpStatus.INTERNAL_SERVER_ERROR.getReasonPhrase());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultThrowableAnalyzer</span> <span class="keyword">extends</span> <span class="title">ThrowableAnalyzer</span> </span>&#123;</span><br><span class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initExtractorMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">super</span>.initExtractorMap();</span><br><span class="line">			registerExtractor(ServletException.class, throwable -&gt; &#123;</span><br><span class="line">				ThrowableAnalyzer.verifyThrowableHierarchy(throwable, ServletException.class);</span><br><span class="line">				<span class="keyword">return</span> ((ServletException) throwable).getRootCause();</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="oauth2authorizationcodegrantfilter"><a class="markdownIt-Anchor" href="#oauth2authorizationcodegrantfilter"></a> OAuth2AuthorizationCodeGrantFilter</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">0. WebAsyncManagerIntegrationFilter </span><br><span class="line">1. SecurityContextPersistenceFilter@6814 </span><br><span class="line">2. HeaderWriterFilter</span><br><span class="line">3. CsrfFilter</span><br><span class="line">4. LogoutFilter </span><br><span class="line"></span><br><span class="line">5. OAuth2AuthorizationRequestRedirectFilter </span><br><span class="line"></span><br><span class="line">6. UsernamePasswordAuthenticationFilter </span><br><span class="line">7. RequestCacheAwareFilter </span><br><span class="line">8. SecurityContextHolderAwareRequestFilter </span><br><span class="line">9. AnonymousAuthenticationFilter </span><br><span class="line"></span><br><span class="line">10. OAuth2AuthorizationCodeGrantFilter </span><br><span class="line"></span><br><span class="line">11. SessionManagementFilter </span><br><span class="line">12. ExceptionTranslationFilter </span><br><span class="line">13. FilterSecurityInterceptor</span><br></pre></td></tr></table></figure>
<h3 id="authorizationredirectstrategy-defaultredirectstrategy"><a class="markdownIt-Anchor" href="#authorizationredirectstrategy-defaultredirectstrategy"></a> authorizationRedirectStrategy : DefaultRedirectStrategy</h3>
<h3 id="defaultoauth2authorizationrequestresolver"><a class="markdownIt-Anchor" href="#defaultoauth2authorizationrequestresolver"></a> DefaultOauth2AuthorizationRequestResolver</h3>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/26/java-map-marker/">java-map-marker</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-26</time><div class="content"><h2 id="map"><a class="markdownIt-Anchor" href="#map"></a> Map</h2>
<ul>
<li>Spatial DB</li>
<li>OGC</li>
<li>POI (Point of Interesting)</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/16/java-calendar-locale-timezone/">java-calendar-locale-timezone</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Date/">Date</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Date/Calendar/">Calendar</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/java/">java</a></span><div class="content"><h2 id="java-date-calendar"><a class="markdownIt-Anchor" href="#java-date-calendar"></a> Java Date &amp; Calendar</h2>
<p>Locale Extension : buddhist, japanese, gregory 형태의 달력 선택 가능</p>
<ul>
<li>BuddhistCalendar (불멸기원 : 석가모니가 입멸한 해를 기준으로 삼는 연대 표기)</li>
<li>JapaneseImperialCalendar (일본 연호 : 일본에서는 새 천황이 즉위하거나 나라에 자연재해가 계속될 때 연호를 바꾼다. )</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BEFORE_MEIJI = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MEIJI = <span class="number">1</span>; (<span class="number">1868</span>년 ~ <span class="number">1912</span>년)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TAISHO = <span class="number">2</span>; </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHOWA = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HEISEI = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REIWA = <span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>GregorianCalendar
<ul>
<li>율리우스력의 바탕이 된 이집트력을 기본으로 하고 1년의 길이를 365.2425일로 정하는 역법체계. 윤년을 포함하는 양력을 말한다.</li>
<li>율리우스력의 오차를 수정한 달력이며, 기본 구조는 율리우스력을 그대로 따르되 윤년을 정하는 규칙을 추가했다.</li>
</ul>
</li>
</ul>
<h2 id="java-locale"><a class="markdownIt-Anchor" href="#java-locale"></a> Java Locale</h2>
<ul>
<li>A Locale object represents a specific geographical, political, or cultural region.</li>
<li>Language, Script, Country</li>
<li><a href="https://docs.oracle.com/cd/E13214_01/wli/docs92/xref/xqisocodes.html" target="_blank" rel="noopener">Country Code &amp; Language Code</a></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">Language Code</th>
<th style="text-align:center">Script Code</th>
<th style="text-align:center">Country</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">한국어</td>
<td style="text-align:center">ko</td>
<td style="text-align:center">Kore</td>
<td style="text-align:center">KR</td>
</tr>
<tr>
<td style="text-align:center">일본어</td>
<td style="text-align:center">ja</td>
<td style="text-align:center"></td>
<td style="text-align:center">JP</td>
</tr>
<tr>
<td style="text-align:center">영어</td>
<td style="text-align:center">en</td>
<td style="text-align:center"></td>
<td style="text-align:center">US</td>
</tr>
</tbody>
</table>
<ul>
<li>Locale 은 Display 속성과 Format 속성을 따로 관리한다.</li>
<li>Display 속성은 언어를 표현하는 단어를 어울러서 가지고 있다.</li>
<li>Format 속성은 Locale 에 해당하는 숫자, 연도 포멧을 가지고 있다.</li>
</ul>
<h2 id="java-timezone"><a class="markdownIt-Anchor" href="#java-timezone"></a> Java TimeZone</h2>
<ul>
<li>
<p><a href="https://ko.wikipedia.org/wiki/%EA%B7%B8%EB%A6%AC%EB%8B%88%EC%B9%98_%ED%8F%89%EA%B7%A0%EC%8B%9C" target="_blank" rel="noopener">GMT(Greenwich Mean Time)</a></p>
<ul>
<li>그리니치 천문대를 기준으로 하는 평균 태양시</li>
</ul>
</li>
<li>
<p><a href="https://ko.wikipedia.org/wiki/%ED%98%91%EC%A0%95_%EC%84%B8%EA%B3%84%EC%8B%9C" target="_blank" rel="noopener">UTC(universal time coordinated)</a></p>
<ul>
<li>세슘 원자의 진동수에 기반한 것으로 오차가 30만년에 1초 수준</li>
</ul>
</li>
<li>
<p>UTC vs GMT</p>
<ul>
<li>초의 소수점 차이만 난다. ms 이하의 값들이 중요하다면 UTC를 쓰고 아니면 GMT를 써도 무방</li>
</ul>
</li>
<li>
<p>타국 타임존</p>
<ul>
<li>UTC, GMT(세계 표준시 ) : 한국시간에 9시간을 빼어 계산한다.</li>
<li>CEST(중부 유럽 서머타임)  : UTC+2 hours , 한국시간에 7시간을 빼어 계산한다.</li>
<li>BST(영국 서머타임)     : UTC+1 hour , 한국시간에 8시간을 빼어 계산한다.</li>
<li>EDT(미국동부 서머타임, 예:뉴욕)   : UTC-4 hours , 한국시간에 13시간을 빼어 계산한다.</li>
<li>CDT(미국중부 서머타임, 예:시카고)   : UTC-5 hours , 한국시간에 14시간을 빼어 계산한다.</li>
<li>CST(중국표준시, 예:타이페이)  : UTC+8 hours , 한국시간에 1시간을 빼어 계산한다.</li>
</ul>
</li>
</ul>
<h2 id="유닉스-시간-posix-epoch"><a class="markdownIt-Anchor" href="#유닉스-시간-posix-epoch"></a> 유닉스 시간 (POSIX, Epoch)</h2>
<ul>
<li>UTC 1970년 1월 1일 00:00:00 부터 경과 시간을 초로 환산하여 정수로 나타낸 것</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/12/spring-util-reflection/">spring-util-reflection</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-12</time><div class="content"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/03/01/project-start-materials/">project-start-materials</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-03-01</time><div class="content"><h2 id="jenkins"><a class="markdownIt-Anchor" href="#jenkins"></a> Jenkins</h2>
<p>CI/CD 환경을 만들기 위해서 가장 익숙한 도구를 사용했다.<br />
war파일을 받아 실행만 하면 매우 쉽기 때문에 설치해서 사용하려고 한다.</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">export HTTP_PORT=9090</span><br><span class="line">export JENKINS_HOME=~/project/jenkins/jenkins_home</span><br><span class="line"></span><br><span class="line">nohup java -jar jenkins.war --httpPort=$HTTP_PORT --sessionTimeout=120 -XX:+AggressiveOpts &gt;&gt; ./logs/jenkins.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>아무 설정도 하지 않으면 JENKINS_HOME을 기본적으로 홈의 .jenkins 폴더에 구성하기 떄문에 Jenkins_home을 지정해주고,<br />
Port 설정을 하지 않으면 8080 포트로 기동 되기에 HTTP_PORT 를 변경할 수 있도록 한다.<br />
그리고 기동 후 $JENKINS_HOME/secrets/initialAdminPassword 를 물어보기 때문에 이를 넣고 기동하도록 하자</p>
<h2 id="docker"><a class="markdownIt-Anchor" href="#docker"></a> Docker</h2>
<p>Docker를 이용한 Container 배포를 하기 위해 로컬에서 Docker를 사용할 수 있도록 설치 해보자<br />
<a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/ubuntu/</a> 에 매우 잘 나와 있다.</p>
<h3 id="set-up-the-repository"><a class="markdownIt-Anchor" href="#set-up-the-repository"></a> SET UP THE REPOSITORY</h3>
<ol>
<li>update the apt package index:</li>
</ol>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Install packages to allow apt to use a repository over HTTPS:</li>
</ol>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install \</span><br><span class="line">     apt-transport-https \</span><br><span class="line">     ca-certificates \</span><br><span class="line">     curl \</span><br><span class="line">     gnupg-agent \</span><br><span class="line">     software-properties-common</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>Add Docker’s official GPG key:<br />
GPG(PGP)는 암호화 프로그램으로 RSA 방식을 사용하며 주로 이메일을 암호화 하는데 사용된다.</li>
</ol>
 <figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"></span><br><span class="line">sudo apt-key fingerprint 0EBFCD88</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>Set up the stable repository<br />
lsb_release -cs 는 Ubuntu distribution 정보를 알수 있다.</li>
</ol>
<ul>
<li>Eoan 19.10</li>
<li>Bionic 18.04 (LTS)</li>
<li>Xenial 16.04 (LTS)</li>
</ul>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"</span><br></pre></td></tr></table></figure>
<h3 id="install-docker-engine-community"><a class="markdownIt-Anchor" href="#install-docker-engine-community"></a> INSTALL DOCKER ENGINE - COMMUNITY</h3>
<ol>
<li>Update the apt package index.</li>
</ol>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Install the latest version of Docker Engine - Community and containerd, or go to the next step to install a specific version:</li>
</ol>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install docker-ce docker-ce-cli containerd.io</span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line">3. Verify that Docker Engine</span><br><span class="line">```shell script</span><br><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>확인</li>
</ol>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Unable to find image 'hello-world:latest' locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">1b930d010525: Pull complete </span><br><span class="line">Digest: sha256:fc6a51919cfeb2e6763f62b6d9e8815acbf7cd2e476ea353743570610737b752</span><br><span class="line">Status: Downloaded newer image for hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"><span class="meta"> $</span><span class="bash"> docker run -it ubuntu bash</span></span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/27/java-fundamental-method-area/">java-fundamental-method-area</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-27</time><div class="content"><p><img src="/images/java/fundamental/method_area/method_area.png" alt="" /></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/02/27/java-fundamental-runtime-data-areas/">java-fundamental-runtime-data-areas</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-27</time><div class="content"><p><img src="/images/java/fundamental/runtime_data_areas/runtime_data_areas.png" alt="" /></p>
<h2 id="runtime-data-areas"><a class="markdownIt-Anchor" href="#runtime-data-areas"></a> Runtime Data Areas</h2>
<ul>
<li>
<p>PC Registers</p>
<ul>
<li>CPU에서 명령어(Instruction)을 수행하는 과정에서 필요한 정보를 레지스터(Register)라고 하는 CPU내 기억장치를 사용한다.</li>
<li>Java의 PC Registers는 Register-Base로 구동되는 방식이 아니라 Stack-Base로 작동한다.</li>
<li>JVM은 CPU에 직접 명령어를 수행하지 않고 Stack에서 Operand를 뽑아내 이를 별도의 메모리 공간에 저장하는 방식을 취하고 있다.</li>
<li>플랫폼 독립적인 설계를 위해 버퍼공간으로 만든 메모리 공간을 PC Registers라고 한다.</li>
</ul>
</li>
<li>
<p>Java Virtual Machine Stacks</p>
<ul>
<li>Thread의 수행 정보를 기록하는 Frame을 저장하는 공간</li>
<li>Thread별로 하나씩 존재하며 Thread가 시작할 때 생성된다.</li>
<li>Stack Frame 이라고 하는 것들로 구성이 되는데 JVM은 Stack Frame을 push,pop 작업만 수행한다.</li>
<li>그래서 이 Stack Frame들의 정보를 Stack Trace또는 Stack Dump를 얻어내어 분석을 하게 된다.</li>
<li>현재 수행하고 있는 Method의 Strack Frame을 Current Frame이라고 한다.</li>
<li>현재 수행하고 있는 Method의 Class를 Current Class이라고 한다.</li>
</ul>
</li>
<li>
<p>Method Area</p>
<ul>
<li>메모리 영역들이 각 Thread마다 할당되는 배타적인 공간인데 반해 Method Area는 모든 thread들이 공유하는 메모리 영역이다.</li>
<li>Load된 Type(Class, Interface)을 저장하는 논리적 메모리 공간</li>
<li>Type의 ByteCode 뿐만 아니라, 모든 변수, 상수, Reference, Method Data등이 포함된다.</li>
<li>Class Variable과 Method와 생성자의 정보도 포함된다. 이 정보들은 ClassLoader에게 넘겨받은 Class File에서 Type관련 정보를<br />
추출하여 저장하게 된다.</li>
<li>Method Area는 JVM이 기동할때 생성이 되고 GC대상이며, 이는 벤더마다 구현이 다르다.</li>
</ul>
</li>
</ul>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By GwangHui Park</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>